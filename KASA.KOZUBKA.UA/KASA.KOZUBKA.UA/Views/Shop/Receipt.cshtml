@model IEnumerable<ua.kozubka.context.ViewModels.RROViewModels.ShopViewModels.RROCartViewModel>
<div class="container">
    <div class="cart-wrapper-area py-3">
        @if (Model.Any())
        {
            <div class="cart-table card mb-3">
                <div class="table-responsive card-body">
                    <table class="table mb-0">
                        <tbody>
                            @foreach (var item in Model)
                            {
                                await Html.RenderPartialAsync("Partial/RROCart/_CartItem", item);
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="shipping-method-choose mb-3">
                <div class="card shipping-method-choose-title-card bg-success">
                    <div class="card-body">
                        <h6 class="text-center mb-0 text-white">Оберіть Тип Оплати</h6>
                    </div>
                </div>
                <div class="card shipping-method-choose-card">
                    <div class="card-body">
                        <div class="shipping-method-choose">
                            <ul class="ps-0">
                                <li>
                                    <input id="@ua.kozubka.context.Classes.Constants.PaydType.Cash" value="@((int)ua.kozubka.context.Classes.Constants.PaydType.Cash)" type="radio" name="paydtype" checked>
                                    <label for="@ua.kozubka.context.Classes.Constants.PaydType.Cash">
                                        <svg class="bi bi-cash mb-2 text-dark" xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"></path>
                                            <path d="M0 4a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V4zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V6a2 2 0 0 1-2-2H3z"></path>
                                        </svg>
                                        <span>Готівка</span>
                                    </label>
                                    <div class="check"></div>
                                </li>
                                <li>
                                    <input id="@ua.kozubka.context.Classes.Constants.PaydType.Cashless" value="@((int)ua.kozubka.context.Classes.Constants.PaydType.Cashless)" type="radio" name="paydtype">
                                    <label for="@ua.kozubka.context.Classes.Constants.PaydType.Cashless">
                                        <svg class="bi bi-credit-card-2-front mb-2 text-dark" xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h12zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H2z"></path>
                                            <path d="M2 5.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"></path>
                                        </svg>
                                        <span>Картка</span>
                                    </label>
                                    <div class="check"></div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card cart-amount-area">
                <div class="card-body d-flex align-items-center justify-content-between">
                    <h5 class="total-price mb-0">Cума: <span id="MainSum">@Model.Sum(d=>d.RROCartPosition.Summa)</span></h5><a href="#" id="PaydReceipt" class="btn btn-warning">Сплатити</a>
                </div>
            </div>
        }
        else
        {
             <div class="shipping-method-choose mb-3">
                <div class="card shipping-method-choose-title-card bg-danger">
                    <div class="card-body">
                        <h6 class="text-center mb-0 text-white">Додайте позиції до чеку</h6>
                    </div>
                </div>
                <div class="card shipping-method-choose-card">
                    <div class="card-body">
                        <div class="shipping-method-choose">
                            <a asp-controller="Shop" asp-action="Index" class="btn btn-warning w-100">Перейти до товарів</a>
                        </div>
                    </div>
                </div>
            </div>
            
        }
    </div>
</div>
 


<div class="modal fade" id="CheckBoxModal" tabindex="-1" aria-labelledby="checboxModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="checboxModalLabel">Сервіс CHECKBOX.UA</h5>
            </div>
            <div class="modal-body">
                <div class="product-catagories">
                    <div class="card user-data-card">
                        <div class="card-body text-center" id="chekDetail">
                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a asp-controller="Shop" asp-action="Index" class="btn btn-warning w-100">Закрити</a>
            </div>
        </div>
    </div>
</div>
<!-- Modal СheckBox -->
<div class="modal fade" id="DiscountBoxModal" tabindex="-1" aria-labelledby="discountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="discountModalLabel">Знижка</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="product-catagories">
                    <div class="card user-info-card">
                        <div class="card-body p-4 d-flex align-items-center">
                            <div class="user-info">
                                <h5 class="mb-0" id="ItemNameDiscount" >Додавання Нового Продукта/Послуги</h5>
                            </div>
                        </div>
                    </div>
                    <div class="card user-data-card">
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="title mb-2"><i class="lni lni-dollar"></i><span>Знижка</span></div>
                                <input  id="input-discount-modal"  class="form-control price-input" type="text" placeholder="0,00">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a id="set-discount-button"  class="btn btn-warning w-100" data-bs-dismiss="modal">Прийняти</a>
            </div>
        </div>
    </div>
</div>
@section ScriptsDown
{
    <script src="~/assets/plugins/jquery.maskplugin2/dist/jquery.mask.min.js"></script>
    <script>
        $(document).ready(function () {
             $(".price-input").mask("0999999.09", { reverse: false });
        });
        $(document).on('click', 'a[href="#"]', function (e) {
            e.preventDefault ? e.preventDefault() : e.returnValue = false;
        });
    </script>
    <script>
        $('body').on('click', '.classmainchange', function () {
            var count = parseInt($(this).parent('.def-number-input').find('input[type=number]').val());
            var idRroGoodsItem = $(this).attr('data-IdRroGoodsItem');
            var ajaxdata={"idRroGoodsItem":idRroGoodsItem,"Count":count};
            $.ajax({
                url: '/api/rrocartapi/updatecount',
                type: "post",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(ajaxdata),
                success: function (result) {
                    if (result.haveResult) {
                       $("#tr-IdRroGoodsItem-"+idRroGoodsItem).replaceWith(result.htmlString);
                       $("#MainSum").text(result.htmlCount);
                    }
                },
            });
        });
        $('body').on('click','.remove-product', function () {
            var idRroGoodsItem = $(this).attr('data-IdRroGoodsItem');
            var ajaxdata={"idRroGoodsItem":idRroGoodsItem};
            $.ajax({
                url: '/api/rrocartapi/RemoveCart',
                type: "post",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(ajaxdata),
                success: function (result) {
                    if (result.haveResult) {
                       $("#tr-IdRroGoodsItem-"+idRroGoodsItem).remove();
                       $("#MainSum").text(result.htmlString);
                    }
                },
            });
        });
        $('body').on('click','.select-discount-button', function() {
            var itemName = $(this).attr('data-itemName');
            $("#ItemNameDiscount").text(itemName);
            $('#input-discount-modal').attr('data-idRROGoodsItem', $(this).attr('data-idRROGoodsItem'));
            $('#input-discount-modal').val($(this).attr('data-discountSum'));
            $('#DiscountBoxModal').modal('show');
        });
        $("#set-discount-button").click(function() {
            var discountSum = $("#input-discount-modal").val();
            if(discountSum=="") discountSum=0;
            var idRroGoodsItem = $("#input-discount-modal").attr('data-IdRroGoodsItem');
            var ajaxdata={"idRroGoodsItem":idRroGoodsItem,"DiscountSum":discountSum};
            $.ajax({
                url: '/api/rrocartapi/updatediscount',
                type: "post",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(ajaxdata),
                success: function (result) {
                    if (result.haveResult) {
                       $("#tr-IdRroGoodsItem-"+idRroGoodsItem).replaceWith(result.htmlString);
                       $("#MainSum").text(result.htmlCount);
                    }
                },
            });
        });
        $("#PaydReceipt").click(function() {
            $(this).hide();
            var paydType =  $('input[name=paydtype]:checked').val();
            var ajaxdata={"PaydType":paydType};
            $.ajax({
                url: '/api/rrocartapi/createreceipt',
                type: "post",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(ajaxdata),
                beforeSend:function(result)
                {
                    $("#preloader").show();
                },
                success: function (result) {
                    if (result.haveResult) {
                        sleep(2000);
                        $("#preloader").hide();
                        $("#chekDetail").html(result.htmlString);
                        $('#CheckBoxModal').modal('show');
                    }
                },
            });
        });
    </script>
    <script>
         function sleep(miliseconds) {
                var currentTime = new Date().getTime();
                while (currentTime + miliseconds >= new Date().getTime()) {
                }
            }
    </script>:
}
       